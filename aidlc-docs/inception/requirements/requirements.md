# 테이블 오더 서비스 요구사항 문서

## 1. 프로젝트 개요

### 1.1 Intent Analysis

**사용자 요청**: 테이블 오더 서비스 개발
- **요청 유형**: New Project (신규 프로젝트)
- **범위 추정**: System-wide (고객용 인터페이스, 관리자용 인터페이스, 서버 시스템)
- **복잡도 추정**: Complex (실시간 주문 모니터링, 세션 관리, 멀티 테넌트)

### 1.2 서비스 비전

디지털 주문 시스템을 통해 고객에게는 편리한 주문 경험을, 매장 운영자에게는 효율적인 운영 환경을 제공하는 차세대 테이블오더 플랫폼

### 1.3 핵심 가치 제안

**고객 관점**:
- 대기 시간 없는 즉시 주문
- 직관적이고 사용하기 쉬운 인터페이스

**매장 운영자 관점**:
- 인건비 절감 및 운영 효율성 증대
- 실시간 주문 관리 및 모니터링

**시장 차별화**:
- 멀티 테넌트 지원으로 여러 레스토랑 동시 운영
- 직관적인 관리자 도구

---

## 2. 기술 스택 및 아키텍처

### 2.1 선택된 기술 스택

**백엔드**:
- Framework: FastAPI (Python)
- Database: PostgreSQL
- Authentication: JWT + bcrypt
- Real-time: Server-Sent Events (SSE)

**프론트엔드**:
- Framework: React
- State Management: React Context/Hooks
- Storage: localStorage (장바구니, JWT 토큰)

**배포 환경**:
- Target: 로컬 개발 환경 (localhost)
- Configuration: 환경 변수 (.env 파일)

### 2.2 아키텍처 특성

**멀티 테넌트 설계**:
- 여러 레스토랑을 단일 시스템에서 관리
- 매장 식별자(store_id)로 데이터 격리
- 확장 가능한 구조

**실시간 통신**:
- SSE 하이브리드 방식: 초기 전체 목록 전송 후 증분 업데이트
- 자동 재연결 + 사용자 알림

**보안**:
- JWT 토큰 localStorage 저장 (16시간 유효)
- bcrypt 비밀번호 해싱
- 테이블별 비밀번호 인증

---

## 3. 기능 요구사항

### 3.1 고객용 기능

#### 3.1.1 테이블 태블릿 자동 로그인 및 세션 관리
- 초기 설정 (관리자 1회 수행): 매장 식별자, 테이블 번호, 테이블 비밀번호 입력
- 로그인 정보 localStorage 저장
- 자동 로그인 기능
- 세션 ID (UUID) 기반 테이블 세션 추적

#### 3.1.2 메뉴 조회 및 탐색
- 메뉴 화면이 기본 화면
- 카테고리별 메뉴 분류
- 메뉴 상세 정보: 메뉴명, 가격, 설명, 이미지 (Base64 인코딩)
- 카드 형태 레이아웃
- 터치 친화적 UI (최소 44x44px 버튼)

#### 3.1.3 장바구니 관리
- 메뉴 추가/삭제, 수량 조절
- 총 금액 실시간 계산
- localStorage 저장 (페이지 새로고침 시 유지)
- 장바구니 비우기 기능

#### 3.1.4 주문 생성
- 주문 내역 최종 확인
- 주문 확정 시:
  - 주문 번호 표시
  - 장바구니 자동 비우기
  - 메뉴 화면으로 자동 리다이렉트
- 주문 정보: 매장 ID, 테이블 ID, 세션 ID, 메뉴 목록, 총 금액
- 에러 발생 시 인라인 메시지 표시

#### 3.1.5 주문 내역 조회
- 현재 테이블 세션의 주문만 표시
- 주문 시간 순 정렬
- 주문 상세 정보: 주문 번호, 시각, 메뉴/수량, 금액, 상태
- 주문 상태: 대기중/준비중/완료

### 3.2 관리자용 기능

#### 3.2.1 매장 인증
- 매장 식별자, 사용자명, 비밀번호 입력
- JWT 토큰 기반 인증 (16시간 유효)
- localStorage에 토큰 저장
- 브라우저 새로고침 시 세션 유지
- 16시간 후 자동 로그아웃

#### 3.2.2 실시간 주문 모니터링
- SSE 기반 실시간 업데이트 (2초 이내)
- 그리드/대시보드 레이아웃
- 기본 뷰: 활성 테이블만 표시 (현재 주문이 있는 테이블)
- 테이블별 카드:
  - 테이블 번호
  - 총 주문액
  - 최신 주문 n개 미리보기
- 주문 카드 클릭 시 전체 메뉴 목록 상세 보기
- 주문 상태 변경: 대기중 → 준비중/완료 (부분 강제)
- 신규 주문 시각적 강조
- SSE 연결 끊김 시 자동 재연결 + 알림

#### 3.2.3 테이블 관리

**테이블 태블릿 초기 설정**:
- 테이블 번호 및 비밀번호 설정
- 16시간 세션 생성

**주문 삭제 (직권 수정)**:
- 특정 주문 삭제 버튼
- 확인 팝업
- 테이블 총 주문액 재계산

**테이블 세션 처리**:
- 세션 시작: 첫 주문 시 UUID 생성
- 세션 종료 (매장 이용 완료):
  - 확인 팝업
  - 해당 세션 주문 내역을 과거 이력으로 이동
  - 테이블 현재 주문 목록 및 총 주문액 리셋

**과거 주문 내역 조회**:
- 테이블별 과거 주문 목록 (시간 역순)
- 주문 정보: 주문 번호, 시각, 메뉴 목록, 총 금액, 완료 시각
- 날짜 필터링 기능

#### 3.2.4 메뉴 관리
- 메뉴 조회 (카테고리별)
- 메뉴 등록: 메뉴명, 가격, 설명, 카테고리, 이미지 (Base64)
- 메뉴 수정
- 메뉴 삭제
- 메뉴 노출 순서 조정
- 필수 필드 및 가격 범위 검증

---

## 4. 비기능 요구사항

### 4.1 성능
- SSE 주문 업데이트: 2초 이내
- 멀티 테넌트 지원: 여러 레스토랑 동시 운영
- 캐싱: 메뉴 + 정적 데이터 (카테고리, 테이블 정보)

### 4.2 보안
- 비밀번호 bcrypt 해싱
- JWT 토큰 기반 인증 (16시간 유효)
- 테이블별 비밀번호 인증
- 매장별 데이터 격리

### 4.3 사용성
- 터치 친화적 UI (최소 44x44px)
- 명확한 시각적 계층 구조
- 인라인 에러 메시지
- 직관적인 네비게이션

### 4.4 테스팅
- 단위 테스트: 개별 함수/컴포넌트
- 통합 테스트: 컴포넌트 상호작용
- E2E 테스트: 전체 사용자 플로우

---

## 5. 데이터 모델

### 5.1 핵심 엔티티

**Store (매장)**:
- store_id (PK)
- store_name
- admin_username
- admin_password_hash

**Table (테이블)**:
- table_id (PK)
- store_id (FK)
- table_number
- table_password_hash
- current_session_id

**TableSession (테이블 세션)**:
- session_id (PK, UUID)
- table_id (FK)
- start_time
- end_time
- is_active

**Menu (메뉴)**:
- menu_id (PK)
- store_id (FK)
- category_id (FK)
- menu_name
- price
- description
- image_base64
- display_order

**Category (카테고리)**:
- category_id (PK)
- store_id (FK)
- category_name
- display_order

**Order (주문)**:
- order_id (PK)
- session_id (FK)
- table_id (FK)
- store_id (FK)
- order_time
- total_amount
- status (대기중/준비중/완료)

**OrderItem (주문 항목)**:
- order_item_id (PK)
- order_id (FK)
- menu_id (FK)
- quantity
- unit_price

**OrderHistory (주문 이력)**:
- history_id (PK)
- session_id (FK)
- completed_time
- (주문 데이터 아카이브)

### 5.2 비즈니스 규칙

**주문 상태 전환**:
- 부분 강제: "준비중"은 건너뛸 수 있지만 "대기중"은 거쳐야 함
- 대기중 → 완료 (허용)
- 대기중 → 준비중 → 완료 (허용)

**세션 관리**:
- 세션 ID는 UUID로 생성
- 첫 주문 시 세션 시작
- 매장 이용 완료 시 세션 종료
- 종료된 세션의 주문은 OrderHistory로 이동

---

## 6. MVP 범위

### 6.1 포함 기능

**고객용**:
- ✅ 테이블 태블릿 자동 로그인
- ✅ 메뉴 조회 및 탐색
- ✅ 장바구니 관리
- ✅ 주문 생성
- ✅ 주문 내역 조회

**관리자용**:
- ✅ 매장 인증 (16시간 세션)
- ✅ 실시간 주문 모니터링 (SSE)
- ✅ 테이블 관리 (초기 설정, 주문 삭제, 세션 처리, 과거 내역)
- ✅ 메뉴 관리

### 6.2 제외 기능

**결제 관련**:
- ❌ 실제 결제 처리
- ❌ 결제 게이트웨이 연동
- ❌ 영수증 발행
- ❌ 환불 처리
- ❌ 포인트/쿠폰 시스템

**인증 및 보안**:
- ❌ OAuth, SNS 로그인
- ❌ 다단계 인증 (2FA, OTP)

**파일 및 컨텐츠 관리**:
- ❌ 이미지 업로드 (Base64만 지원)
- ❌ 이미지 리사이징/최적화
- ❌ 컨텐츠 관리 시스템
- ❌ 광고 기능

**알림 시스템**:
- ❌ 푸시 알림
- ❌ SMS 알림
- ❌ 이메일 발송
- ❌ 소리/진동 알림

**주방 기능**:
- ❌ 주방 전달 시스템
- ❌ 재고 관리

**고급 기능**:
- ❌ 데이터 분석 및 대시보드
- ❌ 매출 리포트
- ❌ 직원 관리 및 권한 설정
- ❌ 예약 시스템
- ❌ 고객 리뷰 시스템
- ❌ 다국어 기능

**외부 연동**:
- ❌ 배달 플랫폼 연동
- ❌ POS 시스템 연동
- ❌ 소셜 미디어 공유

---

## 7. 기술적 결정 요약

| 항목 | 선택 | 근거 |
|------|------|------|
| 백엔드 프레임워크 | FastAPI | 현대적, 빠름, async 지원, 자동 API 문서화 |
| 프론트엔드 프레임워크 | React | 컴포넌트 기반, 큰 생태계, 유연함 |
| 데이터베이스 | PostgreSQL | 관계형, ACID 준수, 멀티 테넌트에 적합 |
| 비밀번호 해싱 | bcrypt | 업계 표준, 요구사항 명시 |
| JWT 저장 | localStorage | 간단함, 16시간 세션 유지 |
| SSE 방식 | 하이브리드 | 초기 전체 목록 + 증분 업데이트 |
| SSE 재연결 | 자동 + 알림 | 사용자 경험 + 투명성 |
| 세션 추적 | UUID | 고유성 보장, 표준 방식 |
| 주문 상태 | 부분 강제 | 유연성 + 최소 검증 |
| 배포 대상 | 로컬 개발 | MVP 단계, 테스트/데모용 |
| 환경 설정 | 환경 변수 | 표준 방식, .env 파일 |
| 장바구니 저장 | localStorage | 요구사항 명시, 페이지 새로고침 유지 |
| 대시보드 뷰 | 활성 테이블만 | 운영 효율성, 집중도 향상 |
| 테스팅 | 전체 스위트 | 품질 보증, 단위+통합+E2E |
| 메뉴 이미지 | Base64 인코딩 | 업로드 제외, 간단한 저장 방식 |
| 에러 처리 | 인라인 메시지 | 컨텍스트 명확성 |
| 예상 규모 | 멀티 테넌트 | 확장성, 여러 레스토랑 지원 |
| 캐싱 | 메뉴+정적 데이터 | 성능 향상, 적절한 균형 |

---

## 8. 다음 단계

이 요구사항 문서를 기반으로 다음 단계를 진행합니다:

1. **User Stories** (선택적): 사용자 스토리 및 페르소나 생성
2. **Workflow Planning**: 실행 계획 수립
3. **Application Design**: 컴포넌트 및 서비스 설계
4. **Units Generation**: 작업 단위 분해
5. **Construction Phase**: 상세 설계 및 코드 생성
