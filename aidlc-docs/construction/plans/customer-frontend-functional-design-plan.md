# Customer Frontend - 기능 설계 계획

## 유닛 컨텍스트
- **유닛 ID**: customer-frontend
- **할당된 스토리**: US-001 ~ US-008 (8개 스토리)
- **기술 스택**: React 18+, React Router, React Query, Context API, Axios, localStorage

## 계획 개요
이 계획은 customer-frontend 유닛의 기능 설계를 개괄하며, 인프라 관심사 없이 비즈니스 로직, 도메인 모델, 비즈니스 규칙에 집중합니다.

---

## 실행 단계

### Step 1: 도메인 엔티티 모델링
- [x] Cart 도메인 엔티티 정의 (항목, 수량, 총액)
- [x] MenuItem 도메인 엔티티 정의 (id, 이름, 가격, 설명, 이미지, 카테고리)
- [x] Order 도메인 엔티티 정의 (주문ID, 항목, 상태, 시각, 테이블ID)
- [x] Customer Session 엔티티 정의 (테이블ID, 매장ID, 인증토큰)
- [x] 엔티티 관계 및 데이터 흐름 문서화

### Step 2: 비즈니스 로직 설계
- [x] 장바구니 관리 로직 설계 (추가, 제거, 수량 변경, 비우기)
- [x] 장바구니 총액 계산 로직 설계
- [x] 주문 생성 워크플로우 설계
- [x] 메뉴 탐색 및 필터링 로직 설계
- [x] 인증 및 세션 관리 로직 설계
- [x] 주문 내역 조회 로직 설계

### Step 3: 비즈니스 규칙 정의
- [x] 장바구니 검증 규칙 정의 (최소 주문, 항목 가용성)
- [x] 수량 제약 정의 (최소: 1, 최대: 10)
- [x] 주문 제출 규칙 정의 (비어있지 않은 장바구니, 유효한 세션)
- [x] localStorage 지속성 규칙 정의 (장바구니, 인증 토큰)
- [x] 자동 로그인 규칙 정의 (토큰 검증, 만료)
- [x] 메뉴 필터링 규칙 정의 (카테고리별, 가용성)

### Step 4: 상태 관리 설계
- [x] CustomerContext 상태 구조 설계
- [x] 장바구니 상태 관리 설계 (액션, 리듀서)
- [x] 인증 상태 관리 설계
- [x] 메뉴 데이터 캐싱 전략 설계 (React Query)
- [x] 주문 내역 상태 관리 설계

### Step 5: 데이터 흐름 설계
- [x] 로그인 → 메뉴 탐색 → 장바구니 → 주문 데이터 흐름 설계
- [x] localStorage 지속성 데이터 흐름 설계
- [x] API 상호작용 데이터 흐름 설계 (로그인, 메뉴, 주문)
- [x] 각 작업의 에러 처리 흐름 설계
- [x] 로딩 상태 관리 설계

---

## 명확화 질문

### 비즈니스 로직 모델링

**Q1: 장바구니 항목 고유성**
고객이 동일한 메뉴 항목을 여러 번 추가할 때, 시스템은:
- A) 각 추가마다 별도의 장바구니 항목 생성
- B) 기존 장바구니 항목의 수량 증가
- C) 고객에게 선택하도록 요청

[Answer]: B

**Q2: 장바구니 총액 계산**
장바구니 총액 계산에 포함되어야 하는 것은:
- A) 항목 소계만 (가격 × 수량)
- B) 항목 소계 + 세금
- C) 항목 소계 + 세금 + 서비스 요금
- D) 기타 (구체적으로 명시)

[Answer]: A

**Q3: 주문 자동 리다이렉트 타이밍**
주문 확인 후, 시스템이 5초 후 메뉴 화면으로 리다이렉트합니다. 이 타이밍은:
- A) 5초로 고정 (명세대로)
- B) 레스토랑에서 설정 가능
- C) 고객이 건너뛸 수 있음 ("쇼핑 계속하기" 버튼)
- D) 기타 (구체적으로 명시)

[Answer]: A

### 도메인 모델

**Q4: 메뉴 항목 가용성**
고객 프론트엔드가 메뉴 항목 가용성(예: "품절" 상태)을 처리해야 하나요?
- A) 예, 가용성 상태 표시 및 주문 불가 항목 방지
- B) 아니오, 표시된 모든 메뉴는 가용하다고 가정
- C) 상태 표시하되 주문 허용 (백엔드에서 검증)

[Answer]: A

**Q5: 장바구니 지속성 기간**
장바구니 데이터가 localStorage에 얼마나 오래 유지되어야 하나요?
- A) 테이블 세션 종료 시까지 (세션 종료 시 삭제)
- B) 무기한 (수동으로 삭제할 때까지)
- C) TTL 적용 (예: 24시간)
- D) 기타 (구체적으로 명시)

[Answer]: A

**Q6: 주문 내역 범위**
주문 내역 표시 시, 시스템이 보여줘야 하는 것은:
- A) 현재 테이블 세션의 주문만
- B) 현재 테이블의 모든 주문 (세션 간)
- C) 현재 세션 주문 + 설정 가능한 시간 범위

[Answer]: A

### 비즈니스 규칙

**Q7: 최소 주문 검증**
최소 주문 금액 또는 항목 수가 있어야 하나요?
- A) 최소 없음 (모든 주문 크기 허용)
- B) 최소 주문 금액 (예: 10,000원)
- C) 최소 항목 수 (예: 1개 항목)
- D) 기타 (구체적으로 명시)

[Answer]: A

**Q8: 최대 장바구니 수량**
장바구니에서 메뉴 항목당 최대 수량은?
- A) 제한 없음
- B) 합리적 제한 (예: 99)
- C) 레스토랑에서 설정 가능한 제한
- D) 기타 (구체적으로 명시)

[Answer]: C. 최대 10개

**Q9: 주문 후 장바구니 수정**
주문이 완료된 후, 고객은:
- A) 즉시 다른 주문 가능 (장바구니 비워짐)
- B) 이전 주문 완료될 때까지 대기 후 주문 가능
- C) 여러 주문 동시 가능 (장바구니 비워지지 않음)

[Answer]: A

### 데이터 흐름

**Q10: 자동 로그인 실패 처리**
자동 로그인이 실패하면 (예: 유효하지 않은 토큰, 만료된 세션), 시스템은:
- A) 에러 표시 및 수동 재로그인 요구
- B) 자동으로 로그인 화면으로 리다이렉트
- C) 지수 백오프로 자동 로그인 재시도
- D) 기타 (구체적으로 명시)

[Answer]: C

**Q11: 메뉴 데이터 갱신 전략**
고객 프론트엔드가 메뉴 데이터를 갱신하는 방법은?
- A) 매 페이지 로드마다 (캐싱 없음)
- B) TTL로 캐싱 (예: 5분)
- C) 무기한 캐싱 (수동 갱신만)
- D) stale-while-revalidate 전략으로 캐싱 (React Query 기본값)

[Answer]: D

**Q12: 주문 상태 폴링**
고객 프론트엔드가 주문 상태 업데이트를 폴링해야 하나요?
- A) 예, X초마다 폴링 (간격 명시)
- B) 아니오, 주문 내역 조회 시에만 상태 표시
- C) SSE 사용하여 실시간 업데이트 (관리자처럼)
- D) 기타 (구체적으로 명시)

[Answer]: A. 5분.

### 에러 처리

**Q13: 네트워크 에러 복구**
주문 제출 중 네트워크 에러가 발생하면, 시스템은:
- A) 에러 표시 및 수동 재시도 허용
- B) 지수 백오프로 자동 재시도
- C) 주문을 로컬에 저장하고 연결 복구 시 재시도
- D) 기타 (구체적으로 명시)

[Answer]: B

**Q14: localStorage 용량 초과**
localStorage 용량이 초과되면 (예: 큰 장바구니), 시스템은:
- A) 에러 표시 및 항목 추가 방지
- B) 가장 오래된 항목 제거하여 공간 확보
- C) 대체 저장 메커니즘 사용 (예: IndexedDB)
- D) 기타 (구체적으로 명시)

[Answer]: B

**Q15: 세션 만료 처리**
고객이 탐색 중 테이블 세션이 만료되면, 시스템은:
- A) 에러 표시 및 재로그인 요구
- B) 자동으로 세션 연장
- C) 탐색 허용하되 주문 시 재로그인 요구
- D) 기타 (구체적으로 명시)

[Answer]: B

### 비즈니스 시나리오

**Q16: 동시 장바구니 수정**
여러 고객이 동일한 태블릿을 동시에 사용하면 (가능성 낮지만), 장바구니 충돌은 어떻게 처리하나요?
- A) 마지막 쓰기 우선 (이전 장바구니 덮어쓰기)
- B) 장바구니 병합 (항목 결합)
- C) 수정 중 장바구니 잠금
- D) 고려 대상 아님 (단일 사용자 가정)

[Answer]: D

**Q17: 메뉴 가격 변경**
항목이 장바구니에 추가된 후 주문 제출 전에 메뉴 가격이 변경되면, 시스템은:
- A) 장바구니 추가 시점의 가격 사용
- B) 주문 제출 시점의 현재 가격 사용
- C) 고객에게 가격 변경 알림 및 확인 요청

[Answer]: B

**Q18: 주문 확인 화면 표시**
주문 확인 화면에서, 시스템이 표시해야 하는 것은:
- A) 주문 번호와 성공 메시지만
- B) 주문 번호 + 주문 요약 (항목, 수량, 총액)
- C) 주문 번호 + 주문 요약 + 예상 준비 시간
- D) 기타 (구체적으로 명시)

[Answer]: C

---

## 다음 단계
모든 질문에 답변하고 모호함이 해결된 후, 다음을 생성합니다:
1. `business-logic-model.md` - 상세 비즈니스 로직 및 알고리즘
2. `domain-entities.md` - 도메인 엔티티 정의 및 관계
3. `business-rules.md` - 비즈니스 규칙, 검증 로직, 제약사항
