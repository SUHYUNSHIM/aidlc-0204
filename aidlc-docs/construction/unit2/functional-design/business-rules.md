# Business Rules - Unit 2: Admin Frontend

## 1. 인증 및 권한 규칙

### BR-AUTH-001: 관리자 로그인 필수
- **규칙**: 모든 관리자 기능은 로그인 후에만 접근 가능
- **검증**: 각 페이지 마운트 시 `isAuthenticated` 확인
- **위반 시**: `/admin/login`으로 리다이렉트

### BR-AUTH-002: JWT 토큰 유효성
- **규칙**: JWT 토큰은 16시간 유효
- **검증**: 토큰 만료 시간 체크 (매 1분)
- **위반 시**: 만료 5분 전 자동 갱신 시도, 실패 시 로그아웃

### BR-AUTH-003: 매장 격리
- **규칙**: 관리자는 자신의 매장 데이터만 조회/수정 가능
- **검증**: 모든 API 요청에 `storeId` 포함
- **위반 시**: 403 에러 (서버에서 처리)

---

## 2. 주문 상태 전환 규칙

### BR-ORDER-001: 주문 상태 전환 제약
- **규칙**: 주문 상태는 다음 전환만 허용
  - `pending` → `preparing`
  - `pending` → `completed` (직접 완료 가능)
  - `preparing` → `completed`
- **검증**: `isValidTransition(from, to)` 함수
- **위반 시**: 드롭다운에서 불가능한 옵션 비활성화

### BR-ORDER-002: 완료된 주문 수정 불가
- **규칙**: `completed` 상태의 주문은 상태 변경 불가
- **검증**: 상태 드롭다운 비활성화
- **위반 시**: UI에서 차단

### BR-ORDER-003: 주문 삭제 확인
- **규칙**: 주문 삭제 시 사용자 확인 필수
- **검증**: 확인 팝업 표시
- **위반 시**: 삭제 취소

### BR-ORDER-004: 신규 주문 강조
- **규칙**: 신규 주문은 3초간 시각적 강조 (노란색 배경)
- **검증**: `isNew` 플래그 + setTimeout
- **위반 시**: N/A (UI 규칙)

---

## 3. SSE 연결 규칙

### BR-SSE-001: SSE 재연결 제한
- **규칙**: SSE 연결 실패 시 최대 5회 재시도
- **검증**: `reconnectAttempts` 카운터
- **위반 시**: 폴링 모드로 전환

### BR-SSE-002: 지수 백오프
- **규칙**: 재연결 지연 시간 = `min(1000 * 2^reconnectAttempts, 16000)` ms
- **검증**: 재연결 시 지연 시간 계산
- **위반 시**: N/A (자동 적용)

### BR-SSE-003: 폴링 백업
- **규칙**: SSE 연결 실패 시 10초마다 폴링 + 수동 새로고침 버튼 제공
- **검증**: `pollingEnabled` 플래그
- **위반 시**: N/A (자동 전환)

### BR-SSE-004: 중복 업데이트 방지
- **규칙**: SSE 이벤트와 API 응답으로 동일 데이터 수신 시 중복 업데이트 방지
- **검증**: 타임스탬프 또는 버전 비교
- **위반 시**: 최신 데이터만 반영

---

## 4. 테이블 관리 규칙

### BR-TABLE-001: 테이블 번호 중복 불가
- **규칙**: 동일 매장 내 테이블 번호는 고유해야 함
- **검증**: 서버에서 409 에러 반환
- **위반 시**: "이미 존재하는 테이블입니다" 에러 메시지

### BR-TABLE-002: 세션 종료 확인
- **규칙**: 테이블 세션 종료 시 사용자 확인 필수
- **검증**: 확인 팝업 표시
- **위반 시**: 세션 종료 취소

### BR-TABLE-003: 활성 테이블만 표시
- **규칙**: 대시보드에는 주문이 있는 테이블만 표시
- **검증**: `orders.length > 0` 필터링
- **위반 시**: N/A (자동 필터링)

### BR-TABLE-004: 테이블 정렬
- **규칙**: 대시보드 테이블 카드는 테이블 번호 오름차순 정렬
- **검증**: `sort((a, b) => a.tableNumber - b.tableNumber)`
- **위반 시**: N/A (자동 정렬)

---

## 5. 메뉴 관리 규칙

### BR-MENU-001: 메뉴명 필수
- **규칙**: 메뉴명은 필수 입력, 1-100자
- **검증**: 폼 검증
- **위반 시**: "메뉴명을 입력해주세요" 에러 메시지

### BR-MENU-002: 가격 양수
- **규칙**: 메뉴 가격은 0보다 커야 함
- **검증**: `price > 0`
- **위반 시**: "가격은 0보다 커야 합니다" 에러 메시지

### BR-MENU-003: 카테고리 필수
- **규칙**: 메뉴는 반드시 카테고리에 속해야 함
- **검증**: `categoryId` 필수
- **위반 시**: "카테고리를 선택해주세요" 에러 메시지

### BR-MENU-004: 이미지 크기 제한
- **규칙**: 메뉴 이미지는 Base64 인코딩 후 최대 1MB
- **검증**: `file.size <= 1048576` (인코딩 전 체크)
- **위반 시**: "이미지 크기는 1MB 이하여야 합니다" 에러 메시지

### BR-MENU-005: 메뉴 삭제 확인
- **규칙**: 메뉴 삭제 시 사용자 확인 필수
- **검증**: 확인 팝업 표시
- **위반 시**: 삭제 취소

### BR-MENU-006: 순서 조정 롤백
- **규칙**: 메뉴 순서 변경 실패 시 이전 순서로 롤백
- **검증**: API 실패 시 로컬 상태 복원
- **위반 시**: N/A (자동 롤백)

---

## 6. 데이터 검증 규칙

### BR-VALID-001: 필수 필드 검증
- **규칙**: 모든 필수 필드는 빈 값 불가
- **검증**: 폼 제출 전 검증
- **위반 시**: 해당 필드에 에러 메시지 표시

### BR-VALID-002: 숫자 필드 검증
- **규칙**: 숫자 필드는 유효한 숫자만 입력 가능
- **검증**: `isNaN()` 체크
- **위반 시**: "유효한 숫자를 입력해주세요" 에러 메시지

### BR-VALID-003: 날짜 형식 검증
- **규칙**: 날짜는 ISO 8601 형식 (YYYY-MM-DDTHH:mm:ssZ)
- **검증**: `new Date(dateString).toString() !== 'Invalid Date'`
- **위반 시**: "유효한 날짜 형식이 아닙니다" 에러 메시지

---

## 7. UI 동작 규칙

### BR-UI-001: 모달 상태 변경 후 닫기
- **규칙**: 주문 상태 변경 후 모달 자동 닫기
- **검증**: API 성공 시 `showOrderDetailModal = false`
- **위반 시**: N/A (자동 적용)

### BR-UI-002: 로딩 상태 표시
- **규칙**: API 요청 중 로딩 인디케이터 표시
- **검증**: `isLoading` 플래그
- **위반 시**: N/A (자동 표시)

### BR-UI-003: 에러 메시지 표시
- **규칙**: API 에러 발생 시 사용자 친화적 메시지 표시
- **검증**: 에러 코드별 메시지 매핑
- **위반 시**: N/A (자동 표시)

### BR-UI-004: 성공 알림
- **규칙**: 중요 작업 성공 시 알림 표시 (3초 자동 닫기)
- **검증**: Toast 컴포넌트
- **위반 시**: N/A (자동 표시)

---

## 8. 과거 주문 내역 규칙

### BR-HISTORY-001: 페이지네이션
- **규칙**: 과거 주문 내역은 페이지당 20개씩 표시
- **검증**: `limit=20` 파라미터
- **위반 시**: N/A (자동 적용)

### BR-HISTORY-002: 시간 역순 정렬
- **규칙**: 과거 주문은 최신 순으로 정렬
- **검증**: `ORDER BY orderTime DESC` (서버)
- **위반 시**: N/A (서버에서 처리)

---

## 9. 에러 처리 규칙

### BR-ERROR-001: 네트워크 에러 재시도
- **규칙**: 네트워크 에러 발생 시 자동 재시도 (최대 3회)
- **검증**: React Query retry 설정
- **위반 시**: 에러 메시지 + 재시도 버튼

### BR-ERROR-002: 401 에러 자동 로그아웃
- **규칙**: 401 에러 발생 시 자동 로그아웃
- **검증**: Axios interceptor
- **위반 시**: N/A (자동 로그아웃)

### BR-ERROR-003: 500 에러 로깅
- **규칙**: 서버 에러 발생 시 콘솔 로그 기록
- **검증**: `console.error()`
- **위반 시**: N/A (자동 로깅)

---

## 10. 보안 규칙

### BR-SEC-001: 토큰 localStorage 저장
- **규칙**: JWT 토큰은 localStorage에 저장
- **검증**: `localStorage.setItem('token', token)`
- **위반 시**: N/A (자동 저장)

### BR-SEC-002: 로그아웃 시 토큰 삭제
- **규칙**: 로그아웃 시 localStorage 토큰 삭제
- **검증**: `localStorage.removeItem('token')`
- **위반 시**: N/A (자동 삭제)

### BR-SEC-003: API 요청 헤더
- **규칙**: 모든 API 요청에 `Authorization: Bearer {token}` 헤더 포함
- **검증**: Axios interceptor
- **위반 시**: 401 에러 (서버에서 처리)

---

## 11. 성능 규칙

### BR-PERF-001: React Query 캐싱
- **규칙**: 메뉴 데이터는 5분간 캐싱
- **검증**: `staleTime: 5 * 60 * 1000`
- **위반 시**: N/A (자동 적용)

### BR-PERF-002: 컴포넌트 메모이제이션
- **규칙**: TableCard는 props 변경 시에만 리렌더링
- **검증**: `React.memo(TableCard)`
- **위반 시**: N/A (자동 적용)

### BR-PERF-003: 계산 메모이제이션
- **규칙**: groupOrdersByTable은 orders 변경 시에만 재계산
- **검증**: `useMemo(() => groupOrdersByTable(orders), [orders])`
- **위반 시**: N/A (자동 적용)

---

## 12. 규칙 우선순위

### 높음 (High)
- BR-AUTH-001, BR-AUTH-002, BR-AUTH-003 (인증)
- BR-ORDER-001, BR-ORDER-002 (주문 상태 전환)
- BR-SSE-001, BR-SSE-002, BR-SSE-003 (SSE 연결)
- BR-ERROR-002 (401 자동 로그아웃)
- BR-SEC-001, BR-SEC-002, BR-SEC-003 (보안)

### 중간 (Medium)
- BR-ORDER-003, BR-ORDER-004 (주문 UI)
- BR-TABLE-001, BR-TABLE-002 (테이블 관리)
- BR-MENU-001, BR-MENU-002, BR-MENU-003, BR-MENU-004 (메뉴 검증)
- BR-VALID-001, BR-VALID-002 (데이터 검증)
- BR-UI-001, BR-UI-002, BR-UI-003 (UI 동작)

### 낮음 (Low)
- BR-TABLE-003, BR-TABLE-004 (테이블 정렬)
- BR-MENU-005, BR-MENU-006 (메뉴 UI)
- BR-HISTORY-001, BR-HISTORY-002 (과거 내역)
- BR-PERF-001, BR-PERF-002, BR-PERF-003 (성능 최적화)
